{% extends 'index.html' %}

{% block titulo %}
{{company.name|title|truncatechars:17|cut:" "}}
{% endblock titulo %}

{% block company %}
<a href="/{{company.id}}/catalogo">
    <marquee behavior="" direction="">{{company.name|title|cut:" "}}</marquee>
</a>
{% endblock company %}

{% block carrito %}
{% include 'catalog/carrito.html' with total_compra=total_compra %}
{% endblock carrito %}

{% block menus %}
{% include 'menu_from_user.html' %}
{% endblock menus %}

{% block hero %} {% endblock hero %}

{% block contenido %}
{% load crispy_forms_tags %}
<section id="team_productos" class="team" style="margin-top: 80px;">
    <div class="container-fluid productos_por_categorias" data-aos="fade-up">

        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <strong>Registrar Precio de Envio</strong>
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                    <div class="accordion-body row d-flex no-gutters justify-content-center">
                        <div class="forn-envio col-lg-5 d-flex align-items-stretch">
                            <div class="input-group">
                                <form action="/{{company.id}}/precio_envio" method="post" id="form_precio_envio">
                                    {% csrf_token %}
                                    {{form_precio|crispy}}
                                    <button type="submit" class="btn btn-primary btn-sm">Regitrar</button>
                                </form>
                            </div>
                        </div>
                        <div class="precios_env col-lg-5 d-flex align-items-stretch">
                            {% for preci in precios %}
                            <li>
                                Precio de envio registrado : <strong>{{preci.precio}} Bs.</strong>
                            </li>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        <strong>Registrar Banco</strong>
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="forn-envio col-lg-5 d-flex align-items-stretch">
                            <div class="input-group">
                                <form action="/{{company.id}}/banco_envio" method="post" id="form_banco_envio">
                                    {% csrf_token %}
                                    {{form_banco|crispy}}
                                    <button type="submit" class="btn btn-primary btn-sm">Regitrar</button>
                                </form>
                            </div>
                        </div>
                        <div class="info_banco col-lg-5 d-flex align-items-stretch">

                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        <strong>Agregar Promociones</strong>
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="forn-envio col-lg-5 d-flex align-items-stretch">
                            <div class="input-group">
                                <form action="/{{company.id}}/add_huvicacion" method="post" id="add_hivicacion_forms">
                                    {% csrf_token %}
                                    {{form_promociones|crispy}}
                                    <button type="submit" class="btn btn-primary btn-sm">Regitrar</button>
                                </form>
                            </div>
                        </div>
                        <div class="info_banco col-lg-5 d-flex align-items-stretch">

                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        <strong>Registrar Huvicaci√≥n</strong>
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="forn-envio col-lg-5 d-flex align-items-stretch">
                            <div class="input-group">
                                <form action="/{{company.id}}/add_huvicacion" method="post" id="add_hivicacion_forms">
                                    {% csrf_token %}
                                    {{form_huvicacion|crispy}}
                                    <button type="submit" class="btn btn-primary btn-sm">Regitrar</button>
                                </form>
                            </div>
                        </div>
                        <div class="info_banco col-lg-5 d-flex align-items-stretch">

                        </div>
                    </div>
                </div>
            </div> -->
        </div>

    </div>
</section>

<script>
    $('#form_precio_envio').on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: $(this).attr('action'),
            data: $(this).serialize(),
            success: function (resp) {
                if (resp.error) {
                    $('.toast-body').addClass('alert alert-danger');
                    $('.toast-body').fadeIn(1000).html(resp.error);
                    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
                    toastBootstrap.show();
                } else {
                    $('.toast-body').addClass('alert alert-success');
                    $('.toast-body').fadeIn(1000).html(resp.success);
                    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
                    toastBootstrap.show();

                    $('.precios_env').html("<li> Precio de Envio Registrado : <strong> " + resp.precio + "Bs.</strong></li>");
                    $('#form_precio_envio')[0].reset();
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                $('.toast-body').addClass('alert alert-danger');
                $('.toast-body').fadeIn(1000).html(thrownError);
                const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
                toastBootstrap.show();
            }
        });
    });

    $('#add_hivicacion_forms').on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: $(this).attr('action'),
            data: $(this).serialize(),
            success: function (resp) {
                if (resp.error) {
                    $(".invalid_ct").html(resp.error);
                } else {

                    $(".btn-close").click();
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("Error:" + thrownError);
            }
        });
    });
</script>
{% endblock contenido %}


{% block button_whatsap %}
{% include 'button_whatsap.html' %}
{% endblock button_whatsap %}
{% block contact %}
<!-- ======= Contact Section ======= -->
<section id="contact" class="contact">
    <div class="container">
        {% include 'contact.html' with company=company %}
    </div>
</section>
<!-- End Contact Section -->
{% endblock contact %}